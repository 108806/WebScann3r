"""
Dangerous sink patterns for WebScann3r

This file contains regex patterns for identifying dangerous function calls and taint sinks
across multiple languages (JS, PHP, Python, Java, .NET, etc). These are used for sink detection
in scanner.py and for generating sinks.md reports.

Expand or update this list as new dangerous sinks are discovered.
"""

sink_patterns = [
    # Code execution (JS, PHP, Python, etc)
    r'(?i)eval\s*\(',
    r'(?i)exec\s*\(',
    r'(?i)system\s*\(',
    r'(?i)popen\s*\(',
    r'(?i)passthru\s*\(',
    r'(?i)proc_open\s*\(',
    r'(?i)assert\s*\(',
    r'(?i)base64_decode\s*\(',
    r'(?i)unserialize\s*\(',
    r'(?i)document\.write\s*\(',
    r'(?i)document\.writeln\s*\(',
    r'(?i)innerHTML\s*=\s*',
    r'(?i)outerHTML\s*=\s*',
    r'(?i)dangerouslySetInnerHTML',
    r'(?i)document\.execCommand\s*\(',
    r'(?i)Function\s*\(',
    r'(?i)new Function',
    r'(?i)window\.Function',
    r'(?i)window\.eval',
    r'(?i)setTimeout\s*\(',
    r'(?i)setInterval\s*\(',
    r'(?i)child_process\.exec\s*\(',
    r'(?i)os\.system\s*\(',
    r'(?i)os\.exec',
    r'(?i)os\.execl',
    r'(?i)os\.execle',
    r'(?i)os\.execlp',
    r'(?i)os\.execlpe',
    r'(?i)os\.execv',
    r'(?i)os\.execve',
    r'(?i)os\.execvp',
    r'(?i)os\.execvpe',
    r'(?i)os\.popen',
    r'(?i)os\.spawn',
    r'(?i)os\.fork',
    r'(?i)os\.forkpty',
    r'(?i)os\.kill',
    r'(?i)os\.killpg',
    r'(?i)os\.startfile',
    r'(?i)subprocess\.(?:call|Popen|run|check_call|check_output)\s*\(',
    r'(?i)input\s*\(',
    r'(?i)pickle\.loads?\s*\(',
    r'(?i)pickle\.load\s*\(',
    r'(?i)yaml\.load\s*\(',
    r'(?i)marshal\.loads\s*\(',
    r'(?i)unmarshal\s*\(',
    r'(?i)ObjectInputStream\.readObject',
    r'(?i)open\s*\(',
    r'(?i)require\s*\(',
    r'(?i)include\s*\(',
    r'(?i)fetch\s*\(',
    r'(?i)axios\.(?:get|post|put|delete|patch)\s*\(',
    r'(?i)\.ajax\s*\(',
    r'(?i)XMLHttpRequest',
    r'(?i)http\.request',
    r'(?i)https\.request',
    r'(?i)requests\.(get|post)',
    r'(?i)urllib\.request',
    r'(?i)curl_exec',
    r'(?i)curl_setopt',
    r'(?i)curl_init',
    r'(?i)socket',
    r'(?i)netcat',
    r'(?i)render_template',
    r'(?i)render',
    r'(?i)twig\.render',
    r'(?i)ejs\.render',
    r'(?i)mustache\.render',
    r'(?i)mysql_query',
    r'(?i)mysqli_query',
    r'(?i)pdo_query',
    r'(?i)pg_query',
    r'(?i)sqlite_query',
    r'(?i)db\.query',
    r'(?i)fs\.(readFile|writeFile|appendFile|createWriteStream|createReadStream|unlink|rmdir)',
    r'(?i)file_get_contents',
    r'(?i)file_put_contents',
    r'(?i)readfile',
    r'(?i)fopen',
    r'(?i)shell_exec',
    r'(?i)create_function',
    r'(?i)preg_replace',
    r'(?i)move_uploaded_file',
    r'(?i)parse_str',
    r'(?i)Runtime.getRuntime\(\)\.exec',
    r'(?i)ProcessBuilder',
    r'(?i)Process.Start',
    r'(?i)Assembly.Load',
    r'(?i)AppDomain.CreateDomain',
    r'(?i)Type.GetType',
    r'(?i)dangerous_function',
    r'(?i)dangerous_eval',
    r'(?i)dangerous_exec',
    r'(?i)compile\s*\(',
    r'(?i)execfile\s*\(',
    r'(?i)exec_module',
    r'(?i)importlib.import_module',
    # DOM/Browser sinks
    r'(?i)document.location',
    r'(?i)window.location',
    r'(?i)location.href',
    r'(?i)location.replace',
    r'(?i)location.assign',
    r'(?i)window.open',
    r'(?i)window.postMessage',
    r'(?i)document.cookie',
    r'(?i)localStorage.setItem',
    r'(?i)sessionStorage.setItem',
    # Additional/expanded sinks
    r'(?i)document.URL',
    r'(?i)document.referrer',
    r'(?i)window.name',
    r'(?i)window.parent',
    r'(?i)window.frames',
    r'(?i)window.top',
    r'(?i)window.self',
    r'(?i)window.content',
    r'(?i)window.defaultStatus',
    r'(?i)window.status',
    r'(?i)window.scrollTo',
    r'(?i)window.scrollBy',
    r'(?i)window.moveTo',
    r'(?i)window.resizeTo',
    r'(?i)window.focus',
    r'(?i)window.blur',
    r'(?i)window.close',
    r'(?i)window.print',
    r'(?i)window.stop',
    r'(?i)window.alert',
    r'(?i)window.confirm',
    r'(?i)window.prompt',
    r'(?i)window.showModalDialog',
    r'(?i)window.showModelessDialog',
    r'(?i)window.setImmediate',
    r'(?i)window.clearImmediate',
    r'(?i)window.setInterval',
    r'(?i)window.clearInterval',
    r'(?i)window.setTimeout',
    r'(?i)window.clearTimeout',
    r'(?i)window.requestAnimationFrame',
    r'(?i)window.cancelAnimationFrame',
    r'(?i)window.requestIdleCallback',
    r'(?i)window.cancelIdleCallback',
    r'(?i)window.postMessage',
    r'(?i)window.dispatchEvent',
    r'(?i)window.addEventListener',
    r'(?i)window.removeEventListener',
    r'(?i)window.onmessage',
    r'(?i)window.onerror',
    r'(?i)window.onunhandledrejection',
    r'(?i)window.onbeforeunload',
    r'(?i)window.onunload',
    r'(?i)window.onhashchange',
    r'(?i)window.onpopstate',
    r'(?i)window.onstorage',
    r'(?i)window.onresize',
    r'(?i)window.onscroll',
    r'(?i)window.onfocus',
    r'(?i)window.onblur',
    r'(?i)window.ononline',
    r'(?i)window.onoffline',
    r'(?i)window.onpagehide',
    r'(?i)window.onpageshow',
    r'(?i)window.onbeforeprint',
    r'(?i)window.onafterprint',
    # Node.js/Server-side JS
    r'(?i)child_process\.spawn',
    r'(?i)child_process\.fork',
    r'(?i)child_process\.execFile',
    r'(?i)child_process\.execSync',
    r'(?i)child_process\.spawnSync',
    r'(?i)child_process\.fork',
    r'(?i)fs\.(chmod|chown|unlink|rmdir|mkdir|readdir|readFile|writeFile|appendFile|createReadStream|createWriteStream)',
    r'(?i)process\.env',
    r'(?i)process\.exit',
    r'(?i)process\.kill',
    r'(?i)process\.abort',
    r'(?i)process\.chdir',
    r'(?i)process\.cwd',
    r'(?i)process\.umask',
    r'(?i)process\.setuid',
    r'(?i)process\.setgid',
    r'(?i)process\.setgroups',
    r'(?i)process\.setegid',
    r'(?i)process\.seteuid',
    r'(?i)process\.setgid',
    r'(?i)process\.setgroups',
    r'(?i)process\.setegid',
    r'(?i)process\.seteuid',
    r'(?i)process\.setgid',
    r'(?i)process\.setgroups',
    r'(?i)process\.setegid',
    r'(?i)process\.seteuid',
    r'(?i)process\.setgid',
    r'(?i)process\.setgroups',
    r'(?i)process\.setegid',
    r'(?i)process\.seteuid',
    r'(?i)process\.setgid',
    r'(?i)process\.setgroups',
    r'(?i)process\.setegid',
    r'(?i)process\.seteuid',
    r'(?i)process\.setgid',
    r'(?i)process\.setgroups',
    r'(?i)process\.setegid',
    r'(?i)process\.seteuid',
    r'(?i)process\.setgid',
    r'(?i)process\.setgroups',
    r'(?i)process\.setegid',
    r'(?i)process\.seteuid',
    r'(?i)process\.setgid',
    r'(?i)process\.setgroups',
    r'(?i)process\.setegid',
    r'(?i)process\.seteuid',
    r'(?i)process\.setgid',
    r'(?i)process\.setgroups',
    r'(?i)process\.setegid',
    r'(?i)process\.seteuid',
    r'(?i)process\.setgid',
    r'(?i)process\.setgroups',
    r'(?i)process\.setegid',
    r'(?i)process\.seteuid',
    # Misc
    r'(?i)dangerous_eval',
    r'(?i)dangerous_exec',
    r'(?i)dangerous_function',
]
